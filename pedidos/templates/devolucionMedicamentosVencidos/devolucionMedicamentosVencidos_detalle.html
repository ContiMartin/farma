{% extends "base-presentacion-pedido.html" %}
{% load staticfiles %}
{% load crispy_forms_tags %}

{% block title %}Devolucion de medicamentos{% endblock %}

{% block panel-heading-right %}
{% endblock %}

{% block tipo-pedido %} Devolucion de medicamentos {% endblock %}

{% block nombre-organizacion %} {{ laboratorio.razonSocial }} {% endblock %}

{% block fecha-pedido %} {% endblock %}

{% block etiqueta-Numero-Y-fecha %}{% endblock %}

{% block nro-pedido %}{% endblock %}

{% block grid %}
    <table class="table table-condensed table-responsive" >
        <thead>
            <tr class="info" align="center">
                <th>Lote</th>
                <th>Medicamento</th>
                <th>Fecha de vencimiento</th>
                <th>Stock</th>
            </tr>
        </thead>
        <tbody>
            {% for lote in lotes%}
                <tr class="clickeable">
                    <td>{{ lote.numero}}</td>
                    <td>{{ lote.medicamento}}</td>
                    <td>{{ lote.fechaVencimiento }}</td>
                    <td>{{ lote.stock}}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}

{% block panel-footer %}
    <div class="panel-footer">
        <div class="pull-right">
            <button id="btn-registrar" class="btn btn-primary" type="submit">Registrar</button>
        </div>
        <div class="clearfix"></div>
    </div>
{% endblock %}

{% block url-pdf %}#{% endblock %}

{% block more-scripts %}

    <script>
        (function(){
            $('#modal-registrar-pedido').on('hidden.bs.modal', function(e){
                window.location = "{% url 'pedidosDeFarmacia' %}";
                e.stopPropagation();
            })

            /****************************** Botones Alta Detalle ***************************************/

            $("#btn-add-detalle").on("click", function(e){
                add_detalle_ajax("{% url 'detallePedidoDeFarmacia_add' %}");
                e.stopPropagation();
            });

            $("#btn-save-detalle").on("click", function(e){
                save_detalle_ajax("{% url 'detallePedidoDeFarmacia_add' %}");
                e.stopPropagation()
            });

            /****************************** Botones Modificacion Detalle ***************************************/
            var id;

            $("#btn-update-detalle").on("click", function(e){
                id = get_selected_row();
                if(id){
                    update_detalle_ajax("/pedidosDeFarmacia/add/detalles/update/" + id + "/");
                }
                e.stopPropagation();
            });

            $("#btn-save-update-detalle").on("click", function(e){
                if(id){
                    save_update_ajax("/pedidosDeFarmacia/add/detalles/update/" + id + "/");
                }
                e.stopPropagation();
            });

            /****************************** Boton Baja Detalle ***************************************/

            $("#btn-delete-detalle").on("click", function(e){
                var id = get_selected_row();
                if(id){
                    $("#modal-delete-detalle").modal('show');
                }
                e.stopPropagation();
            });

            $("#btn-confirmar-baja-detalle").on("click", function(e){
                var id = get_selected_row();
                if(id){
                    delete_detalle_ajax("/pedidosDeFarmacia/add/detalles/delete/" + id + "/");
                    $("#modal-delete-detalle").modal('hide');
                }
                e.stopPropagation();
            });

            /****************************** Boton Registrar Pedido ***************************************/

            $("#btn-registrar").on("click", function(e){
                registrar_pedido_ajax("{% url 'pedidoDeFarmacia_registrar' %}");
                e.stopPropagation();
            });

        })();
    </script>

{% endblock %}
